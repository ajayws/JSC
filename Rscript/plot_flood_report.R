library(mapdata)
library(ggplot2)
library(ggmap)


data_banjir <- read.csv("flood_data.csv")

banjir <- data.frame(lat=data_banjir$latitude,
                     lon=data_banjir$longitude)

indo_map <- get_map(location = 'Jakarta', zoom = 11)
d <- data.frame(lat=c(-6.176302, -6.270339, -6.2211412, -6.119213, -6.282178),
                lon=c(106.792442, 106.830742, 106.81018585, 106.717903, 106.849266))
sungai <- list(c(106.852684020996,-6.23817272624521),c(106.852957606316,-6.2374528174361),
               c(106.853199005127,-6.23655159686677),c(106.853011250496,-6.23579968976258),
               c(106.852861046791,-6.2349677912846),c(106.852705478668,-6.23409856261898),
               c(106.852469444275,-6.23275472160159),c(106.852442622185,-6.23226411211841),
               c(106.852367520332,-6.23181616392874),c(106.852257549763,-6.2306802935907),
               c(106.852190494537,-6.22980572508246),c(106.852254867554,-6.22909913665632),
               c(106.852303147316,-6.22838721452544),c(106.85231924057,-6.22725666953233),
               c(106.852177083492,-6.22653141297209),c(106.852013468742,-6.22580615541022),
               c(106.851819008589,-6.22473559875987),c(106.851824037731,-6.22450795520578),
               c(106.851884303614,-6.22425906369607),c(106.851955298334,-6.22412749361368),
               c(106.852011457086,-6.22382169095163),c(106.852046158165,-6.22338523441882),
               c(106.852107681334,-6.22317275544862),c(106.852205498144,-6.22275454658922),
               c(106.852276492864,-6.2223896655452),c(106.85230457224,-6.22205678115639),
               c(106.852541235276,-6.22113041153777),c(106.852565689478,-6.22067522536417),
               c(106.852492085891,-6.22007433359902),c(106.852501848189,-6.21982811942944),
               c(106.852618898847,-6.21931526292496),c(106.85266889428,-6.21904771700649),
               c(106.852648294443,-6.21874329277446),c(106.852715778587,-6.2185270863514),
               c(106.852729618549,-6.21809756555895),c(106.852717548609,-6.21732030091741),
               c(106.85267932713,-6.21664369311159),c(106.852569021285,-6.21625739299372),
               c(106.852607745677,-6.21538430035342),c(106.852734102868,-6.214975376193),
               c(106.852765692165,-6.21485447998515),c(106.852821421344,-6.21476291465582),
               c(106.852887282148,-6.21465444445663),c(106.853002910502,-6.2146001572696),
               c(106.853125097696,-6.21456901400361),c(106.853234099108,-6.21447990154788),
               c(106.853337736102,-6.21435879170203),c(106.853521653393,-6.21373894893936),
               c(106.85368947743,-6.21299644853543),c(106.853674147715,-6.21286451238243),
               c(106.853527389758,-6.2125752552548),c(106.853488879497,-6.21235863226672),
               c(106.853509377834,-6.21221133712489),c(106.853573941735,-6.21195570366312),
               c(106.853665327726,-6.21176406514856),c(106.853786122574,-6.21155092154033),
               c(106.853933739512,-6.21137510833072),c(106.854109519645,-6.21119396213437),
               c(106.854355037212,-6.21101814880556))
sungai.lon <- c()
sungai.lat <-c()
for (i in 1:length(sungai))
{
  sungai.lon <- append(sungai.lon, sungai[[i]][1])
  sungai.lat <- append(sungai.lat, sungai[[i]][2])
}
sungai.coor <- data.frame(lat = sungai.lat, lon = sungai.lon)
mapPoints <- ggmap(indo_map, legend = "bottomleft") 
mapPoints  <- mapPoints + 
        geom_point(data = banjir, aes(lon, lat), color = 'red', alpha = 0.75, size = 2)
mapPoints <- mapPoints +
        geom_line(data = sungai.coor, aes(lon, lat), color = 'blue', alpha=0.75)
mapPoints <- mapPoints + 
        stat_density2d(
        aes(x = lon, y = lat, fill = ..level..,
          alpha = ..level..),
        size = 2, bins = 4, data = banjir,
        geom = "polygon")
mapPoints


########################### plot heatmap flood report###############
ggmap(indo_map, extent = "panel", maprange=FALSE) +
       geom_density2d(data = banjir, aes(x = lon, y = lat)) +
       stat_density2d(aes(x = lon, y = lat, fill = ..level.., alpha = ..level..),
                    size = 0.01, bins = 16, data = banjir, geom = 'polygon') +
    scale_fill_gradient(low = "grey", high = "red") +
    scale_alpha(range = c(0.25, 0.5), guide = FALSE) +
      labs(x = "Longitude", y = "Latitude", fill = "Banyaknya laporan", 
           title =  "Jumlah Laporan Banjir")
ggsave("jumlah_laporan.png", width = 20, height = 20, units = "cm")

